<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Отправить жалобу</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../my-project/src/assets/css/main.css">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg bg-light">
            <div class="container-fluid">
                <div class="logo">
                    <a href="#">
                        <img src="../my-project/src/img/logo.png">
                    </a>
                </div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <img src="../my-project/src/img/search_icon.png">
                                Поиск
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="report_main_content" id ="main">
        <div class="report-form-holder">
            <form class="report-form">
                <p>
                    <input class="email" name="email" type="text" size="40" placeholder="Введите e-mail">
                </p>
                <p>
                    <textarea class="report_message" name="report_message" cols="40" rows="20" placeholder="Ваша жалоба"></textarea>
                </p>
                <div id="send_rep_button"></div>
            </form>
        </div>
    </main>

    <footer>
        Pixource &copy; 2022
    </footer>

    <script type="text/babel">
        class RepButton extends React.Component{
            async sendEvent(){
                const email = document.getElementsByClassName("email")[0].value;
                const report = document.getElementsByClassName("report_message")[0].value;
                const EMAIL_REGEXP = /^(([^<>()[\].,;:\s@']+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu;
                if(report.length>0) {
                    if (email.match(EMAIL_REGEXP)) {
                        const req = await fetch('https://lr/api/account/check_email/'+email)
                            .then(response => response.json());
                        if (req === 1)
                            ReactDOM.render(<RepSuccess/>, document.getElementById('main'));
                        else alert("Нет пользователя с таким почтовым адресом!");
                    }
                    else alert("Некорректный почтовый адрес!");
                }
                else alert("Введите описание своей жалобы!");
            }

            render(){
                return (
                    <button className="report-send-button" type="button" onClick={this.sendEvent} name="">
                        <b>Отправить</b>
                    </button>
                )
            }
        }
        class RepSuccess extends React.Component{
            render(){
                return(
                    <main className="report_main_content">
                        <div className="report-form-holder">
                            <h3>Жалоба отправлена!</h3>
                        </div>
                    </main>
                )
            }
        }
        ReactDOM.render(<RepButton />, document.getElementById('send_rep_button'))
    </script>
</body>
</html>